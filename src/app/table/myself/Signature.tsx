'use client';
import React, {MutableRefObject, RefObject, useEffect, useRef, useState} from 'react';
import {any} from "prop-types";
import useObserver from "./useObserver";

type OnDrawProps = {
    starting: boolean;
    x: any;
    y: any;
}
const Signature = () => {
    let signature = '{"x":230.19403076171875,"y":62.671661376953125};{"x":227.19403076171875,"y":82.67166137695312};{"x":225.19403076171875,"y":102.67166137695312};{"x":219.19403076171875,"y":145.67166137695312};{"x":218.19403076171875,"y":165.67166137695312};{"x":216.19403076171875,"y":183.67166137695312};{"x":214.19403076171875,"y":187.67166137695312};{"x":213.19403076171875,"y":188.67166137695312};{"x":208.19403076171875,"y":188.67166137695312};{"x":203.19403076171875,"y":188.67166137695312};{"x":192.19403076171875,"y":178.67166137695312};{"x":191.19403076171875,"y":173.67166137695312};{"x":191.19403076171875,"y":170.67166137695312};{"x":189.19403076171875,"y":165.67166137695312};{"x":189.19403076171875,"y":158.67166137695312};{"x":209.19403076171875,"y":139.67166137695312};{"x":234.19403076171875,"y":124.67166137695312};{"x":259.19403076171875,"y":112.67166137695312};{"x":274.19403076171875,"y":105.67166137695312};{"x":282.19403076171875,"y":100.67166137695312};{"x":285.19403076171875,"y":92.67166137695312};{"x":287.19403076171875,"y":82.67166137695312};{"x":288.19403076171875,"y":76.67166137695312};{"x":288.19403076171875,"y":70.67166137695312};{"x":288.19403076171875,"y":67.67166137695312};{"x":288.19403076171875,"y":66.67166137695312};{"x":287.19403076171875,"y":65.67166137695312};{"x":284.19403076171875,"y":72.67166137695312};{"x":279.19403076171875,"y":86.67166137695312};{"x":268.19403076171875,"y":107.67166137695312};{"x":260.19403076171875,"y":141.67166137695312};{"x":254.19403076171875,"y":178.67166137695312};{"x":252.19403076171875,"y":200.67166137695312};{"x":252.19403076171875,"y":208.67166137695312};{"x":253.19403076171875,"y":212.67166137695312};{"x":262.19403076171875,"y":200.67166137695312};{"x":272.19403076171875,"y":190.67166137695312};{"x":283.19403076171875,"y":182.67166137695312};{"x":289.19403076171875,"y":175.67166137695312};{"x":291.19403076171875,"y":168.67166137695312};{"x":291.19403076171875,"y":161.67166137695312};{"x":288.19403076171875,"y":154.67166137695312};{"x":274.19403076171875,"y":141.67166137695312};{"x":245.19403076171875,"y":125.67166137695312};{"x":205.19403076171875,"y":112.67166137695312};{"x":165.19403076171875,"y":101.67166137695312};{"x":143.19403076171875,"y":91.67166137695312};{"x":143.19403076171875,"y":88.67166137695312};{"x":145.19403076171875,"y":85.67166137695312};{"x":151.19403076171875,"y":80.67166137695312};{"x":169.19403076171875,"y":71.67166137695312};{"x":209.19403076171875,"y":58.671661376953125};{"x":257.19403076171875,"y":45.671661376953125};{"x":294.19403076171875,"y":39.671661376953125};{"x":311.19403076171875,"y":35.671661376953125};{"x":312.19403076171875,"y":37.671661376953125};{"x":309.19403076171875,"y":45.671661376953125};{"x":307.19403076171875,"y":50.671661376953125};{"x":293.19403076171875,"y":71.67166137695312};{"x":275.19403076171875,"y":103.67166137695312};{"x":252.19403076171875,"y":147.67166137695312};{"x":223.19403076171875,"y":197.67166137695312};{"x":198.19403076171875,"y":239.67166137695312};{"x":184.19403076171875,"y":271.6716613769531};{"x":178.19403076171875,"y":284.6716613769531};{"x":176.19403076171875,"y":287.6716613769531};{"x":189.19403076171875,"y":264.6716613769531};{"x":214.19403076171875,"y":228.67166137695312};{"x":248.19403076171875,"y":197.67166137695312};{"x":284.19403076171875,"y":176.67166137695312};{"x":313.19403076171875,"y":162.67166137695312};{"x":325.19403076171875,"y":157.67166137695312};{"x":327.19403076171875,"y":155.67166137695312};{"x":327.19403076171875,"y":156.67166137695312};{"x":323.19403076171875,"y":164.67166137695312};{"x":320.19403076171875,"y":173.67166137695312};{"x":317.19403076171875,"y":186.67166137695312};{"x":315.19403076171875,"y":195.67166137695312};{"x":315.19403076171875,"y":196.67166137695312};{"x":321.19403076171875,"y":196.67166137695312};{"x":328.19403076171875,"y":189.67166137695312};{"x":337.19403076171875,"y":182.67166137695312};{"x":343.19403076171875,"y":172.67166137695312};{"x":344.19403076171875,"y":163.67166137695312};{"x":342.19403076171875,"y":154.67166137695312};{"x":328.19403076171875,"y":146.67166137695312};{"x":262.19403076171875,"y":137.67166137695312};{"x":186.19403076171875,"y":127.67166137695312};{"x":117.19403076171875,"y":123.67166137695312};{"x":76.19403076171875,"y":121.67166137695312};{"x":73.19403076171875,"y":121.67166137695312};{"x":72.19403076171875,"y":120.67166137695312};{"x":72.19403076171875,"y":119.67166137695312};{"x":75.19403076171875,"y":116.67166137695312};{"x":76.19403076171875,"y":115.67166137695312};{"x":85.19403076171875,"y":110.67166137695312};{"x":118.19403076171875,"y":105.67166137695312};{"x":193.19403076171875,"y":100.67166137695312};{"x":315.19403076171875,"y":82.67166137695312};{"x":352.19403076171875,"y":75.67166137695312};{"x":369.19403076171875,"y":72.67166137695312};{"x":368.19403076171875,"y":72.67166137695312};';
    const canvasRef = useRef<HTMLCanvasElement>(null);
    const ctx = useRef<CanvasRenderingContext2D | null>(null);
    const [isDrown, setIsDrawn] = useState(false)
    useObserver(canvasRef, drawAsync, isDrown, {
        rootMargin: '0% 0% -100px 0%',
    });

    useEffect(() => {
        if (canvasRef.current?.getContext('2d'))
        ctx.current = canvasRef.current.getContext('2d');
        canvasRef.current?.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        })
    }, []);


    async function drawAsync() {
        const coords = signature.split(';');
        ctx.current?.moveTo(JSON.parse(coords[0]).x, JSON.parse(coords[0]).y);
        for (let i = 0; i < coords.length; i++) {
            if (!coords[i].length) {
                break;
            }
            const coordsObj: {x: number, y: number} = JSON.parse(coords[i]);
            await new Promise((res) => setTimeout(() => {
                draw(coordsObj.x, coordsObj.y);
                res(1);
            }, 20))
                .then(() => {});
        }
    }


    const draw = (x: number, y: number) => {
        const lineWidth = 5;
        ctx.current!.lineWidth = lineWidth;
        ctx.current!.lineCap = 'round';
        ctx.current!.lineJoin = 'round'
        ctx.current!.strokeStyle = '#b51034';
        ctx.current?.lineTo(x, y);
        ctx.current?.stroke();
        ctx.current?.beginPath();
        ctx.current?.moveTo(x, y);
    }


    return (
        <canvas ref={canvasRef}
                width={700}
                height={400}
                tabIndex={1}
        ></canvas>
    )
};

export default Signature;